{% extends 'customertemp/masterpage.html' %}
{% load static %}
 
{% block content %}
<section>
  <div class="container-fluid">
  <div class="row">
      <div class="col-12 col-md-3" style="background-color: #969b9f;">
          <button type="button" class="m-2 border-0 pl-4 pr-4" style="background-color:#cbcbcd ;height: 28px; font-size: 12px; font-weight: 500;" >FILTER</button>
          <select class="form-select border-0 pl-3" aria-label="Disabled select example" style="background-color:#cbcbcd ; width: 170px; height: 28px; font-size: 11px; font-weight: 500;"  >                    
              <option selected>SORT BY</option>
              <option value="1">One</option>
              <option value="2">Two</option>
              <option value="3">Three</option>
            </select></div>
      <div class="col-12 col-md-9 pt-2"  style="background-color: #969b9f;">      
            <span style="font-size: 12px; color: #626464;">COMPARE   </span>
            <span class="p-4"  style="font-size: 12px; color: #626464;">/</span>
            <span style="font-size: 12px; color: #626464;">Select up to 4 items to compare</span>
         
      </div>
  </div>
</div>
</section>
<section>
    <div class="container">
        <div class="row p-3">
            <div class="col-12">
                <div class="alert alert-secondary text-danger" role="alert">
                    {{ message }}
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-7">
                <h2 class="text-secondary">Delivery Address</h2>
                <p class="font-weight-normal">Arimbra,Malappuram</p>
            </div>
        </div>
        <div class="row p-3">
            <div class="col-md-7 col-8 bg-light pt-3">
                {% for i in cart %}
                <div class="d-flex flex-row bd-highlight mb-3">
                    <div class="p-2 bd-highlight">
                        <img class="d-inline" height="200px" src="{{i.proimg.url}}" alt="First slide">
                    </div>
                    <div class="p-2 bd-highlight">
                        <h3 class="d-inline">{{i.protitle}}</h3>
                        <h5>{{i.prosubtitle}}</h5>
                        <span class="font-weight-bold">Price : {{ i.price }}</span><br/>
                        <label>Qty : </label>
                        <input class="border-0" id="qty{{ forloop.counter }}" data-item = "{{ i.id }}" type="number" width="10" min="1" style="width: 40px;" max="{{i.stock}}" value="1">
                        <label class="text-danger" id="out"></label><br/>
                        <span>Total : </span><label  class="totalamnt" value="{{i.price}}" readonly id="amt{{ i.id }}">{{i.price}}</label>
                        <label class="text-danger" id="out"></label><br/>
                        <span class="font-weight-bold">Seller Name: {{ i.seller.seller_fname }}</span>
                        <a href="{% url 'customer:remove_cart' i.id %}" class="btn btn-big btn-danger mt-3">Remove</a>

                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="col-12 col-md-4 bg-light p-4 ml-5">
                <h2 class="text-secondary">Price Details</h2>
                <div class="d-flex justify-content-between flex-row bd-highlight mb-3">
                    <div class="p-2 bd-highlight">
                        <h5 class="pt-3">Price Item:</h5>
                    </div>
                    <div class="p-2 bd-highlight"></div>
        
                    </div>
                <div class="d-flex justify-content-between flex-row bd-highlight mb-3">
                    <div class="p-2 bd-highlight">
                        <h5 class="pt-3 d-inline">Delivery Charge:</h5>
                    </div>
                    <div class="p-2 bd-highlight">
                        <h5 class="text-success d-inline">Free</h5>
                    </div>
                </div>
                <div class="d-flex justify-content-between flex-row bd-highlight mb-3 bg-sec">
                    <div class="p-2 bd-highlight">
                        <h5 class="pt-3 d-inline">Total Amount: </h5>
                    </div>
                    <div class="p-2 bd-highlight">
                        <h5 class="d-inline"><label id="grand_total"></label></h5>
                    </div>
                </div>
            </div>
        </div>
        <div>
</section>
<section>
  <div class="container">
    <div class="row m-3">
      <div class="col-12 text-center">
      
        <a href="" class="btn btn-big btn-lg btn-warning text-light">Place Order</a>
      </div>
    </div>
  </div>
</section>

<script>
  $(document).ready(function(){
    

    displayTotalAmt()
    $.ajaxSetup({
      headers:{
        "X-CSRFToken":'{{ csrf_token }}'
      }
    })
    $('input').change(function(){
      let qty = $(this).val()
      let pid = $(this).attr('data-item')
      
         
      $.ajax({
        url : "{% url 'customer:get_total' %}",
        data : {
          'qty' : qty,
          'pid' : pid
        },
        method : 'POST',
        success: function(response){
          $('#amt' + pid).text(response.amount)
          $('#out').text(response.message)
         

          displayTotalAmt()
        }
      })
      
    })
  })
</script>
<script>

function displayTotalAmt(){
  
  var amt_txt =document.getElementsByClassName('totalamnt')
  var total = 0
  for (let i = 0; i<amt_txt.length; i++){

    total =parseInt(total) + parseInt(amt_txt[i].innerHTML)
    document.getElementById('grand_total').innerHTML ="â‚¹" + total
  }
}
</script>
{% endblock %}
 
 
  


